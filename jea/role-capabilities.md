---
ms.date: 07/10/2019
keywords: jea, powershell, säkerhet
title: JEA rollfunktioner
ms.openlocfilehash: 7191b90e198ffb539da6870a8ddc3e449ad9e8ae
ms.sourcegitcommit: 46bebe692689ebedfe65ff2c828fe666b443198d
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 07/10/2019
ms.locfileid: "67726609"
---
# <a name="jea-role-capabilities"></a><span data-ttu-id="ac2d9-103">JEA rollfunktioner</span><span class="sxs-lookup"><span data-stu-id="ac2d9-103">JEA Role Capabilities</span></span>

<span data-ttu-id="ac2d9-104">När du skapar en JEA-slutpunkt som du behöver definiera en eller flera rollfunktioner som beskriver vad någon kan göra i en JEA-session.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-104">When creating a JEA endpoint, you need to define one or more role capabilities that describe what someone can do in a JEA session.</span></span> <span data-ttu-id="ac2d9-105">En roll-funktionen är en PowerShell-datafilen med den `.psrc` tillägg som visar en lista över alla cmdlet: ar, funktioner, leverantörer och externa program som är tillgängliga för användare att ansluta.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-105">A role capability is a PowerShell data file with the `.psrc` extension that lists all the cmdlets, functions, providers, and external programs that are made available to connecting users.</span></span>

## <a name="determine-which-commands-to-allow"></a><span data-ttu-id="ac2d9-106">Avgöra vilka kommandon för att tillåta</span><span class="sxs-lookup"><span data-stu-id="ac2d9-106">Determine which commands to allow</span></span>

<span data-ttu-id="ac2d9-107">Det första steget i att skapa en fil för roll-funktionen är att tänka på vad användare behöver åtkomst till.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-107">The first step in creating a role capability file is to consider what the users need access to.</span></span> <span data-ttu-id="ac2d9-108">Kraven Insamlingsprocessen kan ta en stund, men det är en viktig process.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-108">The requirements gathering process can take a while, but it's an important process.</span></span> <span data-ttu-id="ac2d9-109">Ge användare åtkomst till tillräckligt många cmdletar och funktioner kan hindra dem från att få sitt jobb.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-109">Giving users access to too few cmdlets and functions can prevent them from getting their job done.</span></span> <span data-ttu-id="ac2d9-110">Att tillåta åtkomst till för många cmdletar och funktioner kan användarna göra mer än du avsedd och begränsa effekten av din säkerhet åtgärder.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-110">Allowing access to too many cmdlets and functions can allow users to do more than you intended and weaken your security stance.</span></span>

<span data-ttu-id="ac2d9-111">Hur du går tillväga för den här processen beror på din organisation och mål.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-111">How you go about this process depends on your organization and goals.</span></span> <span data-ttu-id="ac2d9-112">Följande tips kan hjälpa att kontrollera att du befinner dig på rätt väg.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-112">The following tips can help ensure you're on the right path.</span></span>

1. <span data-ttu-id="ac2d9-113">**Identifiera** kommandon användare använder för att få sitt arbete.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-113">**Identify** the commands users are using to get their jobs done.</span></span> <span data-ttu-id="ac2d9-114">Detta kan omfatta överblick över IT-personal, kontrollerar automatiseringsskript eller analysera loggar och betyg för PowerShell-session.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-114">This may involve surveying IT staff, checking automation scripts, or analyzing PowerShell session transcripts and logs.</span></span>
2. <span data-ttu-id="ac2d9-115">**Uppdatera** använda kommandoradsverktyg till PowerShell-motsvarighet, där det är möjligt, för bästa gransknings- och JEA anpassning upplevelse.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-115">**Update** use of command-line tools to PowerShell equivalents, where possible, for the best auditing and JEA customization experience.</span></span> <span data-ttu-id="ac2d9-116">Vara det går inte att begränsad till externa program som detaljerat som interna PowerShell-cmdletar och funktioner i JEA.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-116">External programs can't be constrained as granularly as native PowerShell cmdlets and functions in JEA.</span></span>
3. <span data-ttu-id="ac2d9-117">**Begränsa** omfånget för cmdletar för att endast tillåta att specifika parametrar eller parametervärden.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-117">**Restrict** the scope of the cmdlets to only allow specific parameters or parameter values.</span></span> <span data-ttu-id="ac2d9-118">Detta är särskilt viktigt om användare ska hantera bara en del av ett system.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-118">This is especially important if users should manage only part of a system.</span></span>
4. <span data-ttu-id="ac2d9-119">**Skapa** egna funktioner för att ersätta komplexa kommandon eller kommandon som är svåra att begränsa i JEA.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-119">**Create** custom functions to replace complex commands or commands that are difficult to constrain in JEA.</span></span> <span data-ttu-id="ac2d9-120">En enkel funktion som omsluter ett kommando som komplexa eller gäller ytterligare validering av logik kan erbjuda ytterligare kontroll för enkelhetens skull administratörer och slutanvändare.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-120">A simple function that wraps a complex command or applies additional validation logic can offer additional control for admins and end-user simplicity.</span></span>
5. <span data-ttu-id="ac2d9-121">**Testa** begränsade listan över tillåtna kommandon med dina användare eller automation-tjänster, och justera vid behov.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-121">**Test** the scoped list of allowable commands with your users or automation services, and adjust as necessary.</span></span>

### <a name="examples-of-potentially-dangerous-commands"></a><span data-ttu-id="ac2d9-122">Exempel på potentiellt skadliga kommandon</span><span class="sxs-lookup"><span data-stu-id="ac2d9-122">Examples of potentially dangerous commands</span></span>

<span data-ttu-id="ac2d9-123">Försiktig med kommandon är viktigt att se till att JEA-slutpunkt inte tillåter användare att utöka sina behörigheter.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-123">Careful selection of commands is important to ensure the JEA endpoint doesn't allow the user to elevate their permissions.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="ac2d9-124">Viktig information som krävs för användaren successCommands i en JEA-session ofta körs med förhöjd behörighet.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-124">Essential information required for user successCommands in a JEA session are often run with elevated privileges.</span></span>

<span data-ttu-id="ac2d9-125">I följande tabell innehåller exempel på kommandon som du kan använda medvetet om tillåts i en obegränsad tillstånd.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-125">The following table contains examples of commands that can be used maliciously if allowed in an unconstrained state.</span></span> <span data-ttu-id="ac2d9-126">Detta är inte en fullständig förteckning och bör endast användas som utgångspunkt systemprinciper.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-126">This isn't an exhaustive list and should only be used as a cautionary starting point.</span></span>

|                                            <span data-ttu-id="ac2d9-127">Risk</span><span class="sxs-lookup"><span data-stu-id="ac2d9-127">Risk</span></span>                                            |                                <span data-ttu-id="ac2d9-128">Exempel</span><span class="sxs-lookup"><span data-stu-id="ac2d9-128">Example</span></span>                                |                                                                              <span data-ttu-id="ac2d9-129">Relaterade kommandon</span><span class="sxs-lookup"><span data-stu-id="ac2d9-129">Related commands</span></span>                                                                              |
| ------------------------------------------------------------------------------------------ | --------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <span data-ttu-id="ac2d9-130">Bevilja den anslutande användaren administratörsbehörigheter för att kringgå JEA</span><span class="sxs-lookup"><span data-stu-id="ac2d9-130">Granting the connecting user admin privileges to bypass JEA</span></span>                                | `Add-LocalGroupMember -Member 'CONTOSO\jdoe' -Group 'Administrators'` | <span data-ttu-id="ac2d9-131">`Add-ADGroupMember`, `Add-LocalGroupMember`, `net.exe`, `dsadd.exe`</span><span class="sxs-lookup"><span data-stu-id="ac2d9-131">`Add-ADGroupMember`, `Add-LocalGroupMember`, `net.exe`, `dsadd.exe`</span></span>                                                                                                        |
| <span data-ttu-id="ac2d9-132">Köra godtycklig kod, till exempel skadlig kod, trojaner eller anpassade skript att kringgå skydd</span><span class="sxs-lookup"><span data-stu-id="ac2d9-132">Running arbitrary code, such as malware, exploits, or custom scripts to bypass protections</span></span> | `Start-Process -FilePath '\\san\share\malware.exe'`                   | <span data-ttu-id="ac2d9-133">`Start-Process`, `New-Service`, `Invoke-Item`, `Invoke-WmiMethod`, `Invoke-CimMethod`, `Invoke-Expression`, `Invoke-Command`, `New-ScheduledTask`, `Register-ScheduledJob`</span><span class="sxs-lookup"><span data-stu-id="ac2d9-133">`Start-Process`, `New-Service`, `Invoke-Item`, `Invoke-WmiMethod`, `Invoke-CimMethod`, `Invoke-Expression`, `Invoke-Command`, `New-ScheduledTask`, `Register-ScheduledJob`</span></span> |

## <a name="create-a-role-capability-file"></a><span data-ttu-id="ac2d9-134">Skapa en roll funktionen fil</span><span class="sxs-lookup"><span data-stu-id="ac2d9-134">Create a role capability file</span></span>

<span data-ttu-id="ac2d9-135">Du kan skapa en ny fil med funktionen för rollen av PowerShell i [New PSRoleCapabilityFile](/powershell/module/microsoft.powershell.core/new-psrolecapabilityfile?view=powershell-6) cmdlet.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-135">You can create a new PowerShell role capability file with the [New-PSRoleCapabilityFile](/powershell/module/microsoft.powershell.core/new-psrolecapabilityfile?view=powershell-6) cmdlet.</span></span>

```powershell
New-PSRoleCapabilityFile -Path .\MyFirstJEARole.psrc
```

<span data-ttu-id="ac2d9-136">Den resulterande roll funktion filen måste redigeras för att tillåta de kommandon som krävs för rollen.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-136">The resulting role capability file should be edited to allow the commands required for the role.</span></span> <span data-ttu-id="ac2d9-137">I PowerShell-hjälpen innehåller flera exempel på hur du kan konfigurera filen.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-137">The PowerShell help documentation contains several examples of how you can configure the file.</span></span>

### <a name="allowing-powershell-cmdlets-and-functions"></a><span data-ttu-id="ac2d9-138">PowerShell-cmdletar och funktioner</span><span class="sxs-lookup"><span data-stu-id="ac2d9-138">Allowing PowerShell cmdlets and functions</span></span>

<span data-ttu-id="ac2d9-139">Om du vill tillåta användare att köra PowerShell-cmdletar eller funktioner, lägger du till cmdlet eller funktionen namnet VisibleCmdlets eller VisibleFunctions fält.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-139">To authorize users to run PowerShell cmdlets or functions, add the cmdlet or function name to the VisibleCmdlets or VisibleFunctions fields.</span></span> <span data-ttu-id="ac2d9-140">Om du är osäker på om ett kommando är en cmdlet eller funktion, kan du köra `Get-Command <name>` och kontrollera den **CommandType** -egenskapen i utdata.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-140">If you aren't sure whether a command is a cmdlet or function, you can run `Get-Command <name>` and check the **CommandType** property in the output.</span></span>

```powershell
VisibleCmdlets = 'Restart-Computer', 'Get-NetIPAddress'
```

<span data-ttu-id="ac2d9-141">Ibland är omfånget för en specifik cmdlet eller funktion för breda för dina användares behov.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-141">Sometimes the scope of a specific cmdlet or function is too broad for your users' needs.</span></span> <span data-ttu-id="ac2d9-142">En DNS-administratör kan till exempel förmodligen bara behöver åtkomst till för att starta om DNS-tjänsten.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-142">A DNS admin, for example, probably only needs access to restart the DNS service.</span></span> <span data-ttu-id="ac2d9-143">Klienter har åtkomst till själva hanteringsverktyg i miljöer med flera innehavare.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-143">In multi-tenant environments, tenants have access to self-service management tools.</span></span> <span data-ttu-id="ac2d9-144">Klienter bör begränsas till att hantera sina egna resurser.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-144">Tenants should be limited to managing their own resources.</span></span> <span data-ttu-id="ac2d9-145">För dessa fall kan begränsa du vilka parametrar som exponeras från cmdlet eller funktion.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-145">For these cases, you can restrict which parameters are exposed from the cmdlet or function.</span></span>

```powershell
VisibleCmdlets = @{ Name = 'Restart-Computer'; Parameters = @{ Name = 'Name' }}
```

<span data-ttu-id="ac2d9-146">I mer avancerade scenarier kan du också behöva begränsar de värden som en användare kan använda med dessa parametrar.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-146">In more advanced scenarios, you may also need to restrict the values a user may use with these parameters.</span></span> <span data-ttu-id="ac2d9-147">Rollfunktioner kan du definiera en uppsättning värden eller ett mönster för reguljärt uttryck som bestämmer vilka inmatning är tillåten.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-147">Role capabilities let you define a set of values or a regular expression pattern that determine what input is allowed.</span></span>

```powershell
VisibleCmdlets = @{ Name = 'Restart-Service'; Parameters = @{ Name = 'Name'; ValidateSet = 'Dns', 'Spooler' }},
                 @{ Name = 'Start-Website'; Parameters = @{ Name = 'Name'; ValidatePattern = 'HR_*' }}
```

> [!NOTE]
> <span data-ttu-id="ac2d9-148">Den [vanliga PowerShell-parametrar](/powershell/module/microsoft.powershell.core/about/about_commonparameters) tillåts alltid, även om du begränsar tillgängliga parametrar.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-148">The [common PowerShell parameters](/powershell/module/microsoft.powershell.core/about/about_commonparameters) are always allowed, even if you restrict the available parameters.</span></span>
> <span data-ttu-id="ac2d9-149">Du bör inte uttryckligen ange dem i fältet parametrar.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-149">You should not explicitly list them in the Parameters field.</span></span>

<span data-ttu-id="ac2d9-150">Tabellen nedan beskrivs de olika metoder som du kan anpassa en synlig cmdlet eller funktion.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-150">The table below describes the various ways you can customize a visible cmdlet or function.</span></span>
<span data-ttu-id="ac2d9-151">Du kan blanda och matchar någon av de nedan i den **VisibleCmdlets** fält.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-151">You can mix and match any of the below in the **VisibleCmdlets** field.</span></span>

|                                           <span data-ttu-id="ac2d9-152">Exempel</span><span class="sxs-lookup"><span data-stu-id="ac2d9-152">Example</span></span>                                           |                                                             <span data-ttu-id="ac2d9-153">Användningsfall</span><span class="sxs-lookup"><span data-stu-id="ac2d9-153">Use case</span></span>                                                              |
| ------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------- |
| <span data-ttu-id="ac2d9-154">`'My-Func'` eller `@{ Name = 'My-Func' }`</span><span class="sxs-lookup"><span data-stu-id="ac2d9-154">`'My-Func'` or `@{ Name = 'My-Func' }`</span></span>                                                      | <span data-ttu-id="ac2d9-155">Tillåter användaren att köra `My-Func` utan begränsningar på parametrarna.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-155">Allows the user to run `My-Func` without any restrictions on the parameters.</span></span>                                                      |
| `'MyModule\My-Func'`                                                                        | <span data-ttu-id="ac2d9-156">Tillåter användaren att köra `My-Func` från modulen `MyModule` utan begränsningar på parametrarna.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-156">Allows the user to run `My-Func` from the module `MyModule` without any restrictions on the parameters.</span></span>                           |
| `'My-*'`                                                                                    | <span data-ttu-id="ac2d9-157">Gör att användaren kan köra alla cmdlet eller funktion med verbet `My`.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-157">Allows the user to run any cmdlet or function with the verb `My`.</span></span>                                                                 |
| `'*-Func'`                                                                                  | <span data-ttu-id="ac2d9-158">Gör att användaren kan köra alla cmdlet eller funktion med substantivet `Func`.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-158">Allows the user to run any cmdlet or function with the noun `Func`.</span></span>                                                               |
| `@{ Name = 'My-Func'; Parameters = @{ Name = 'Param1'}, @{ Name = 'Param2' }}`              | <span data-ttu-id="ac2d9-159">Tillåter användaren att köra `My-Func` med den `Param1` och `Param2` parametrar.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-159">Allows the user to run `My-Func` with the `Param1` and `Param2` parameters.</span></span> <span data-ttu-id="ac2d9-160">Vilket värde som kan anges till parametrar.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-160">Any value can be supplied to the parameters.</span></span>          |
| `@{ Name = 'My-Func'; Parameters = @{ Name = 'Param1'; ValidateSet = 'Value1', 'Value2' }}` | <span data-ttu-id="ac2d9-161">Tillåter användaren att köra `My-Func` med den `Param1` parametern.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-161">Allows the user to run `My-Func` with the `Param1` parameter.</span></span> <span data-ttu-id="ac2d9-162">Endast ”Value1” och ”Value2” kan anges för parametern.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-162">Only "Value1" and "Value2" can be supplied to the parameter.</span></span>        |
| `@{ Name = 'My-Func'; Parameters = @{ Name = 'Param1'; ValidatePattern = 'contoso.*' }}`    | <span data-ttu-id="ac2d9-163">Tillåter användaren att köra `My-Func` med den `Param1` parametern.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-163">Allows the user to run `My-Func` with the `Param1` parameter.</span></span> <span data-ttu-id="ac2d9-164">Ett värde som börjar med ”contoso” kan anges för parametern.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-164">Any value starting with "contoso" can be supplied to the parameter.</span></span> |

> [!WARNING]
> <span data-ttu-id="ac2d9-165">Metodtips för säkerhet rekommenderas inte att använda jokertecken när du definierar synliga cmdletar eller funktioner.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-165">For best security practices, it is not recommended to use wildcards when defining visible cmdlets or functions.</span></span> <span data-ttu-id="ac2d9-166">I stället en lista med varje betrodd kommando för att kontrollera att inga andra kommandon som delar samma namngivningsschemat oavsiktligt har behörighet.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-166">Instead, you should explicitly list each trusted command to ensure no other commands that share the same naming scheme are unintentionally authorized.</span></span>

<span data-ttu-id="ac2d9-167">Du kan inte använda både en **ValidatePattern** och **ValidateSet** till samma cmdlet eller funktion.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-167">You can't apply both a **ValidatePattern** and **ValidateSet** to the same cmdlet or function.</span></span>

<span data-ttu-id="ac2d9-168">Om du gör den **ValidatePattern** åsidosätter den **ValidateSet**.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-168">If you do, the **ValidatePattern** overrides the **ValidateSet**.</span></span>

<span data-ttu-id="ac2d9-169">Mer information om **ValidatePattern**, Kolla in [detta *Hey, Scripting Guy!* publicera](https://devblogs.microsoft.com/scripting/validate-powershell-parameters-before-running-the-script/) och [PowerShell reguljära uttryck](/powershell/module/microsoft.powershell.core/about/about_regular_expressions)Referensinnehåll.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-169">For more information about **ValidatePattern**, check out [this *Hey, Scripting Guy!* post](https://devblogs.microsoft.com/scripting/validate-powershell-parameters-before-running-the-script/) and the [PowerShell Regular Expressions](/powershell/module/microsoft.powershell.core/about/about_regular_expressions) reference content.</span></span>

### <a name="allowing-external-commands-and-powershell-scripts"></a><span data-ttu-id="ac2d9-170">Vilket gör att externa kommandon och PowerShell-skript</span><span class="sxs-lookup"><span data-stu-id="ac2d9-170">Allowing external commands and PowerShell scripts</span></span>

<span data-ttu-id="ac2d9-171">Om du vill tillåta användare att köra körbara filer och PowerShell-skript (.ps1) i en JEA-session, du måste lägga till den fullständiga sökvägen till varje program i den **VisibleExternalCommands** fält.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-171">To allow users to run executables and PowerShell scripts (.ps1) in a JEA session, you have to add the full path to each program in the **VisibleExternalCommands** field.</span></span>

```powershell
VisibleExternalCommands = 'C:\Windows\System32\whoami.exe', 'C:\Program Files\Contoso\Scripts\UpdateITSoftware.ps1'
```

<span data-ttu-id="ac2d9-172">Om möjligt, har cmdlet eller funktion som motsvarar för eventuella externa körbara filer du auktoriserar eftersom du kontroll över de parametrar som tillåts med PowerShell-cmdletar och funktioner för att använda PowerShell.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-172">Where possible, to use PowerShell cmdlet or function equivalents for any external executables you authorize since you have control over the parameters allowed with PowerShell cmdlets and functions.</span></span>

<span data-ttu-id="ac2d9-173">Många körbara filer kan du läsa det aktuella tillståndet och ändra den genom att ange olika parametrar.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-173">Many executables allow you to read the current state and then change it by providing different parameters.</span></span>

<span data-ttu-id="ac2d9-174">Anta exempelvis att rollen för fil serveradministratören som hanterar nätverksresurser som finns på ett system.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-174">For example, consider the role of a file server admin that manages network shares hosted on a system.</span></span> <span data-ttu-id="ac2d9-175">Ett sätt att hantera filresurser är att använda `net share`.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-175">One way of managing shares is to use `net share`.</span></span> <span data-ttu-id="ac2d9-176">Dock tillåter **net.exe** initieras eftersom användaren kan använda kommandot för att få administratörsprivilegier med `net group Administrators unprivilegedjeauser /add`.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-176">However, allowing **net.exe** is dangerous because the user could use the command to gain admin privileges with `net group Administrators unprivilegedjeauser /add`.</span></span> <span data-ttu-id="ac2d9-177">Ett säkrare alternativ är att tillåta [Get-SmbShare](/powershell/module/smbshare/get-smbshare), vilket ger samma resultat men har en mycket mer begränsad omfattning.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-177">A more secure option is to allow [Get-SmbShare](/powershell/module/smbshare/get-smbshare), which achieves the same result but has a much more limited scope.</span></span>

<span data-ttu-id="ac2d9-178">När du gör externa kommandon tillgängliga för användare i en JEA-session kan du alltid ange den fullständiga sökvägen till den körbara filen.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-178">When making external commands available to users in a JEA session, always specify the complete path to the executable.</span></span> <span data-ttu-id="ac2d9-179">Detta förhindrar att körningen av på samma sätt namngivna och potentiellt skadliga program som finns någon annanstans i systemet.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-179">This prevents the execution of similarly named and potentially malicious programs located elsewhere on the system.</span></span>

### <a name="allowing-access-to-powershell-providers"></a><span data-ttu-id="ac2d9-180">Att tillåta åtkomst till PowerShell-providers</span><span class="sxs-lookup"><span data-stu-id="ac2d9-180">Allowing access to PowerShell providers</span></span>

<span data-ttu-id="ac2d9-181">Som standard finns inga PowerShell-providers i JEA-sessioner.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-181">By default, no PowerShell providers are available in JEA sessions.</span></span> <span data-ttu-id="ac2d9-182">Detta minskar risken för känslig information och konfigurationsinställningar som avslöjas för anslutande användaren.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-182">This reduces the risk of sensitive information and configuration settings being disclosed to the connecting user.</span></span>

<span data-ttu-id="ac2d9-183">Om det behövs kan du tillåta åtkomst till PowerShell-providers med hjälp av den `VisibleProviders` kommando.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-183">When necessary, you can allow access to the PowerShell providers using the `VisibleProviders` command.</span></span> <span data-ttu-id="ac2d9-184">En fullständig lista över providers, köra `Get-PSProvider`.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-184">For a full list of providers, run `Get-PSProvider`.</span></span>

```powershell
VisibleProviders = 'Registry'
```

<span data-ttu-id="ac2d9-185">Överväg att skriva en egen funktion som fungerar med providern för användarens räkning för enkla uppgifter som kräver åtkomst till filsystemet, registret, certifikatarkivet eller andra leverantörer av känslig.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-185">For simple tasks that require access to the file system, registry, certificate store, or other sensitive providers, consider writing a custom function that works with the provider on the user's behalf.</span></span> <span data-ttu-id="ac2d9-186">Funktioner, cmdletar och externa program som är tillgängliga i en JEA-session är inte samma begränsningar som JEA.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-186">The functions, cmdlets, and external programs available in a JEA session aren't subject to the same constraints as JEA.</span></span> <span data-ttu-id="ac2d9-187">De kan komma åt valfri provider som standard.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-187">They can access any provider by default.</span></span> <span data-ttu-id="ac2d9-188">Överväga att använda den [enheten](session-configurations.md#user-drive) när kopierar filer till eller från en JEA-slutpunkt krävs.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-188">Also consider using the [user drive](session-configurations.md#user-drive) when copying files to or from a JEA endpoint is required.</span></span>

### <a name="creating-custom-functions"></a><span data-ttu-id="ac2d9-189">Skapa anpassade funktioner</span><span class="sxs-lookup"><span data-stu-id="ac2d9-189">Creating custom functions</span></span>

<span data-ttu-id="ac2d9-190">Du kan skapa egna funktioner i en roll funktionen fil att förenkla komplexa uppgifter för dina slutanvändare.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-190">You can author custom functions in a role capability file to simplify complex tasks for your end users.</span></span> <span data-ttu-id="ac2d9-191">Anpassade funktioner är också användbara när du behöver avancerade validering av logik för cmdleten parametervärden.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-191">Custom functions are also useful when you require advanced validation logic for cmdlet parameter values.</span></span> <span data-ttu-id="ac2d9-192">Du kan skriva enkla funktioner i den **FunctionDefinitions** fält:</span><span class="sxs-lookup"><span data-stu-id="ac2d9-192">You can write simple functions in the **FunctionDefinitions** field:</span></span>

```powershell
VisibleFunctions = 'Get-TopProcess'

FunctionDefinitions = @{
    Name = 'Get-TopProcess'

    ScriptBlock = {
        param($Count = 10)

        Get-Process | Sort-Object -Property CPU -Descending |
            Microsoft.PowerShell.Utility\Select-Object -First $Count
    }
}
```

> [!IMPORTANT]
> <span data-ttu-id="ac2d9-193">Glöm inte att lägga till namnet på din anpassade funktioner till den **VisibleFunctions** fältet så att de kan köras av JEA-användare.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-193">Don't forget to add the name of your custom functions to the **VisibleFunctions** field so they can be run by the JEA users.</span></span>

<span data-ttu-id="ac2d9-194">Brödtext (skriptblock) för egna funktioner körs i standardläget för språk för systemet och är inte begränsningar för JEAS språk.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-194">The body (script block) of custom functions runs in the default language mode for the system and isn't subject to JEA's language constraints.</span></span> <span data-ttu-id="ac2d9-195">Det innebär att funktioner kan komma åt filsystem och register och köra kommandon som inte görs visas i filen roll funktionen.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-195">This means that functions can access the file system and registry, and run commands that weren't made visible in the role capability file.</span></span> <span data-ttu-id="ac2d9-196">Var noga med för att undvika att köra godtycklig kod när du använder parametrar.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-196">Take care to avoid running arbitrary code when using parameters.</span></span> <span data-ttu-id="ac2d9-197">Undvika rörnät indata från användaren direkt till cmdlets som `Invoke-Expression`.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-197">Avoid piping user input directly into cmdlets like `Invoke-Expression`.</span></span>

<span data-ttu-id="ac2d9-198">I exemplet ovan, Observera att det fullständigt kvalificerade modulnamnet (FQMN) `Microsoft.PowerShell.Utility\Select-Object` användes i stället för snabbformat `Select-Object`.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-198">In the above example, notice that the fully qualified module name (FQMN) `Microsoft.PowerShell.Utility\Select-Object` was used instead of the shorthand `Select-Object`.</span></span>
<span data-ttu-id="ac2d9-199">Funktionerna som definieras i rollen funktionsfiler omfattas fortfarande JEA-sessioner,-omfattning som innehåller funktioner för proxy JEA skapar för att begränsa befintliga kommandon.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-199">Functions defined in role capability files are still subject to the scope of JEA sessions, which includes the proxy functions JEA creates to constrain existing commands.</span></span>

<span data-ttu-id="ac2d9-200">Som standard `Select-Object` är en begränsad cmdlet i alla JEA-sessioner som inte tillåter valet av godtycklig egenskaper för objekt.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-200">By default, `Select-Object` is a constrained cmdlet in all JEA sessions that doesn't allow the selection of arbitrary properties on objects.</span></span> <span data-ttu-id="ac2d9-201">Du använder den obegränsad `Select-Object` i funktioner, måste du uttryckligen begära detta fullständigt implementerat med hjälp av FQMN.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-201">To use the unconstrained `Select-Object` in functions, you must explicitly request the full implementation using the FQMN.</span></span> <span data-ttu-id="ac2d9-202">En begränsad cmdlet i en JEA-session har samma begränsningar när anropas från en funktion.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-202">Any constrained cmdlet in a JEA session has the same constraints when invoked from a function.</span></span> <span data-ttu-id="ac2d9-203">Mer information finns i [about_Command_Precedence](/powershell/module/microsoft.powershell.core/about/about_command_precedence).</span><span class="sxs-lookup"><span data-stu-id="ac2d9-203">For more information, see [about_Command_Precedence](/powershell/module/microsoft.powershell.core/about/about_command_precedence).</span></span>

<span data-ttu-id="ac2d9-204">Om du skriver flera anpassade funktioner, är det mer praktiskt att placera dem i en modul för PowerShell-skript.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-204">If you're writing several custom functions, it's more convenient to put them in a PowerShell script module.</span></span> <span data-ttu-id="ac2d9-205">Du gör dessa funktioner synliga i JEA-session med den **VisibleFunctions** fältet precis som med inbyggda och tredjeparts-moduler.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-205">You make those functions visible in the JEA session using the **VisibleFunctions** field like you would with built-in and third-party modules.</span></span>

<span data-ttu-id="ac2d9-206">För fliken slutförande ska fungera korrekt i JEA-sessioner du inkludera den inbyggda funktionen `tabexpansion2` i den **VisibleFunctions** lista.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-206">For tab completion to work properly in JEA sessions you must include the built-in function `tabexpansion2` in the **VisibleFunctions** list.</span></span>

## <a name="place-role-capabilities-in-a-module"></a><span data-ttu-id="ac2d9-207">Placera rollfunktioner i en modul</span><span class="sxs-lookup"><span data-stu-id="ac2d9-207">Place role capabilities in a module</span></span>

<span data-ttu-id="ac2d9-208">För PowerShell för att hitta en roll funktionen fil, måste den vara lagrad i en **RoleCapabilities** mapp i en PowerShell-modul.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-208">In order for PowerShell to find a role capability file, it must be stored in a **RoleCapabilities** folder in a PowerShell module.</span></span> <span data-ttu-id="ac2d9-209">Modulen kan lagras i valfri mapp som ingår i den `$env:PSModulePath` miljövariabeln, men du bör inte placera den i System32 eller en mapp där den ej betrodda, ansluter användare kan ändra filerna.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-209">The module can be stored in any folder included in the `$env:PSModulePath` environment variable, however you shouldn't place it in System32 or a folder where the untrusted, connecting users could modify the files.</span></span> <span data-ttu-id="ac2d9-210">Nedan visas ett exempel för att skapa en grundläggande PowerShell skriptmodul kallas **ContosoJEA** i den `$env:ProgramFiles` sökväg.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-210">Below is an example of creating a basic PowerShell script module called **ContosoJEA** in the `$env:ProgramFiles` path.</span></span>

```powershell
# Create a folder for the module
$modulePath = Join-Path $env:ProgramFiles "WindowsPowerShell\Modules\ContosoJEA"
New-Item -ItemType Directory -Path $modulePath

# Create an empty script module and module manifest.
# At least one file in the module folder must have the same name as the folder itself.
New-Item -ItemType File -Path (Join-Path $modulePath "ContosoJEAFunctions.psm1")
New-ModuleManifest -Path (Join-Path $modulePath "ContosoJEA.psd1") -RootModule "ContosoJEAFunctions.psm1"

# Create the RoleCapabilities folder and copy in the PSRC file
$rcFolder = Join-Path $modulePath "RoleCapabilities"
New-Item -ItemType Directory $rcFolder
Copy-Item -Path .\MyFirstJEARole.psrc -Destination $rcFolder
```

<span data-ttu-id="ac2d9-211">Mer information om PowerShell-moduler finns i [förstå en PowerShell-modul](/powershell/developer/windows-powershell).</span><span class="sxs-lookup"><span data-stu-id="ac2d9-211">For more information about PowerShell modules, see [Understanding a PowerShell Module](/powershell/developer/windows-powershell).</span></span>

## <a name="updating-role-capabilities"></a><span data-ttu-id="ac2d9-212">Uppdaterar rollfunktioner</span><span class="sxs-lookup"><span data-stu-id="ac2d9-212">Updating role capabilities</span></span>

<span data-ttu-id="ac2d9-213">Du kan redigera en roll funktionen fil för att uppdatera inställningarna när som helst.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-213">You can edit a role capability file to update the settings at any time.</span></span> <span data-ttu-id="ac2d9-214">Alla nya JEA-sessioner som startas när funktionen för rollen har uppdaterats visas de ändrade funktionerna.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-214">Any new JEA sessions started after the role capability has been updated will reflect the revised capabilities.</span></span>

<span data-ttu-id="ac2d9-215">Det är därför det är så viktigt att kontrollera åtkomst till mappen rollen funktioner.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-215">This is why controlling access to the role capabilities folder is so important.</span></span> <span data-ttu-id="ac2d9-216">Endast betrodda administratörer ska kunna ändra rollen funktionsfiler.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-216">Only highly trusted administrators should be allowed to change role capability files.</span></span> <span data-ttu-id="ac2d9-217">Om en icke betrodd användare kan ändra rollen funktionsfiler, ge enkelt sig själva åtkomst till cmdletar för att de kan utöka sina privilegier.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-217">If an untrusted user can change role capability files, they can easily give themselves access to cmdlets that allow them to elevate their privileges.</span></span>

<span data-ttu-id="ac2d9-218">Kontrollera att lokalt System har läsbehörighet till rollen funktionsfiler och som innehåller moduler för administratörer som vill låsa åtkomst till rollfunktioner för.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-218">For administrators looking to lock down access to the role capabilities, ensure Local System has read access to the role capability files and containing modules.</span></span>

## <a name="how-role-capabilities-are-merged"></a><span data-ttu-id="ac2d9-219">Hur rollfunktioner slås samman</span><span class="sxs-lookup"><span data-stu-id="ac2d9-219">How role capabilities are merged</span></span>

<span data-ttu-id="ac2d9-220">Användare som beviljas åtkomst till alla matchande rollfunktioner i den [session konfigurationsfilen](session-configurations.md) när de kommer in en JEA-session.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-220">Users are granted access to all matching role capabilities in the [session configuration file](session-configurations.md) when they enter a JEA session.</span></span> <span data-ttu-id="ac2d9-221">JEA försöker ge användaren den mest Tillåtande uppsättningen kommandon som tillåts av någon av rollerna.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-221">JEA tries to give the user the most permissive set of commands allowed by any of the roles.</span></span>

### <a name="visiblecmdlets-and-visiblefunctions"></a><span data-ttu-id="ac2d9-222">VisibleCmdlets och VisibleFunctions</span><span class="sxs-lookup"><span data-stu-id="ac2d9-222">VisibleCmdlets and VisibleFunctions</span></span>

<span data-ttu-id="ac2d9-223">Den mest avancerade merge logiken påverkar cmdletar och funktioner som kan ha sina parametrar och parametervärden som är begränsad i JEA.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-223">The most complex merge logic affects cmdlets and functions, which can have their parameters and parameter values limited in JEA.</span></span>

<span data-ttu-id="ac2d9-224">Reglerna är följande:</span><span class="sxs-lookup"><span data-stu-id="ac2d9-224">The rules are as follows:</span></span>

1. <span data-ttu-id="ac2d9-225">Om en cmdlet syns bara i en enda roll, är det synliga för användaren med tillämpliga parametern villkor.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-225">If a cmdlet is only made visible in one role, it is visible to the user with any applicable parameter constraints.</span></span>
2. <span data-ttu-id="ac2d9-226">Om en cmdlet syns i mer än en roll, och varje roll har samma begränsningar i cmdleten, är cmdlet: en synliga för användaren med dessa begränsningar.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-226">If a cmdlet is made visible in more than one role, and each role has the same constraints on the cmdlet, the cmdlet is visible to the user with those constraints.</span></span>
3. <span data-ttu-id="ac2d9-227">Om en cmdlet syns i mer än en roll, och varje roll kan en annan uppsättning parametrar, visas cmdlet: en och alla de parametrar som definierats för varje roll för användaren.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-227">If a cmdlet is made visible in more than one role, and each role allows a different set of parameters, the cmdlet and all the parameters defined across every role are visible to the user.</span></span>
   <span data-ttu-id="ac2d9-228">Om en roll inte har begränsningar i parametrarna, är alla parametrar tillåtna.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-228">If one role doesn't have constraints on the parameters, all parameters are allowed.</span></span>
4. <span data-ttu-id="ac2d9-229">Om en roll definierar verifiera set eller verifiera mönster för en cmdlet-parameter och annan roll kan parametern men begränsar inte parametervärdena, ignoreras verifiera set eller mönster.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-229">If one role defines a validate set or validate pattern for a cmdlet parameter, and the other role allows the parameter but does not constrain the parameter values, the validate set or pattern is ignored.</span></span>
5. <span data-ttu-id="ac2d9-230">Om en uppsättning verifiera har definierats för samma cmdlet-parametern i mer än en roll, tillåts alla värden från alla verifiera uppsättningar.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-230">If a validate set is defined for the same cmdlet parameter in more than one role, all values from all validate sets are allowed.</span></span>
6. <span data-ttu-id="ac2d9-231">Om ett verifiera mönster har definierats för samma cmdlet-parametern i mer än en roll, är värden som matchar någon av mönster som tillåtna.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-231">If a validate pattern is defined for the same cmdlet parameter in more than one role, any values that match any of the patterns are allowed.</span></span>
7. <span data-ttu-id="ac2d9-232">Om en uppsättning verifiera har definierats i en eller flera roller och ett verifiera mönster har definierats i en annan roll för samma cmdlet-parameter, verifiera uppsättningen ignoreras och regeln (6) gäller för de återstående verifiera mönster.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-232">If a validate set is defined in one or more roles, and a validate pattern is defined in another role for the same cmdlet parameter, the validate set is ignored and rule (6) applies to the remaining validate patterns.</span></span>

<span data-ttu-id="ac2d9-233">Nedan visas ett exempel på hur roller slås samman enligt reglerna:</span><span class="sxs-lookup"><span data-stu-id="ac2d9-233">Below is an example of how roles are merged according to these rules:</span></span>

```powershell
# Role A Visible Cmdlets
$roleA = @{
    VisibleCmdlets = 'Get-Service',
                     @{ Name = 'Restart-Service';
                        Parameters = @{ Name = 'DisplayName'; ValidateSet = 'DNS Client' } }
}

# Role B Visible Cmdlets
$roleB = @{
    VisibleCmdlets = @{ Name = 'Get-Service';
                        Parameters = @{ Name = 'DisplayName'; ValidatePattern = 'DNS.*' } },
                     @{ Name = 'Restart-Service';
                        Parameters = @{ Name = 'DisplayName'; ValidateSet = 'DNS Server' } }
}

# Resulting permissions for a user who belongs to both role A and B
# - The constraint in role B for the DisplayName parameter on Get-Service
#   is ignored because of rule #4
# - The ValidateSets for Restart-Service are merged because both roles use
#   ValidateSet on the same parameter per rule #5
$mergedAandB = @{
    VisibleCmdlets = 'Get-Service',
                     @{ Name = 'Restart-Service';
                        Parameters = @{ Name = 'DisplayName'; ValidateSet = 'DNS Client', 'DNS Server' } }
}
```

### <a name="visibleexternalcommands-visiblealiases-visibleproviders-scriptstoprocess"></a><span data-ttu-id="ac2d9-234">VisibleExternalCommands, VisibleAliases, VisibleProviders, ScriptsToProcess</span><span class="sxs-lookup"><span data-stu-id="ac2d9-234">VisibleExternalCommands, VisibleAliases, VisibleProviders, ScriptsToProcess</span></span>

<span data-ttu-id="ac2d9-235">Alla andra fält i filen roll funktionen läggs till i en kumulativ uppsättning med tillåtna externa kommandon, alias, leverantörer och startskript.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-235">All other fields in the role capability file are added to a cumulative set of allowable external commands, aliases, providers, and startup scripts.</span></span> <span data-ttu-id="ac2d9-236">Alla kommandot, alias, provider eller skript som är tillgängliga i en roll-funktionen är tillgänglig för JEA-användaren.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-236">Any command, alias, provider, or script available in one role capability is available to the JEA user.</span></span>

<span data-ttu-id="ac2d9-237">Var noga med att kontrollera att en kombinerad uppsättning-provider från en roll funktions- och kommandon/cmdlets/funktioner från en annan inte ge användarna oavsiktlig åtkomst till systemresurser.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-237">Be careful to ensure that the combined set of providers from one role capability and cmdlets/functions/commands from another don't allow users unintentional access to system resources.</span></span>
<span data-ttu-id="ac2d9-238">Om en roll kan till exempel den `Remove-Item` cmdlet och ett annat kan den `FileSystem` provider, du kan vara utsatta för en JEA-användare som tar bort godtyckliga filer på datorn.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-238">For example, if one role allows the `Remove-Item` cmdlet and another allows the `FileSystem` provider, you are at risk of a JEA user deleting arbitrary files on your computer.</span></span> <span data-ttu-id="ac2d9-239">Mer information om hur du identifierar användarnas gällande behörigheter finns i den [granskning JEA](audit-and-report.md) artikeln.</span><span class="sxs-lookup"><span data-stu-id="ac2d9-239">Additional information about identifying users' effective permissions can be found in the [auditing JEA](audit-and-report.md) article.</span></span>

## <a name="next-steps"></a><span data-ttu-id="ac2d9-240">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="ac2d9-240">Next steps</span></span>

[<span data-ttu-id="ac2d9-241">Skapa en konfigurationsfil för session</span><span class="sxs-lookup"><span data-stu-id="ac2d9-241">Create a session configuration file</span></span>](session-configurations.md)
