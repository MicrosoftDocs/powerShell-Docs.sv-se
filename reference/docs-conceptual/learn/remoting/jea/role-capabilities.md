---
ms.date: 07/10/2019
keywords: Jea, PowerShell, säkerhet
title: JEA roll funktioner
ms.openlocfilehash: 5b5b5977d4fec1ed850f1146fe7c09463908651b
ms.sourcegitcommit: 4a26c05f162c4fa347a9d67e339f8a33e230b9ba
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 03/06/2020
ms.locfileid: "78405009"
---
# <a name="jea-role-capabilities"></a><span data-ttu-id="becd4-103">JEA roll funktioner</span><span class="sxs-lookup"><span data-stu-id="becd4-103">JEA Role Capabilities</span></span>

<span data-ttu-id="becd4-104">När du skapar en JEA-slutpunkt måste du definiera en eller flera roll funktioner som beskriver vad någon kan göra i en JEA-session.</span><span class="sxs-lookup"><span data-stu-id="becd4-104">When creating a JEA endpoint, you need to define one or more role capabilities that describe what someone can do in a JEA session.</span></span> <span data-ttu-id="becd4-105">En roll funktion är en PowerShell-datafil med `.psrc`-tillägget som visar alla cmdletar, funktioner, providers och externa program som görs tillgängliga för att ansluta användare.</span><span class="sxs-lookup"><span data-stu-id="becd4-105">A role capability is a PowerShell data file with the `.psrc` extension that lists all the cmdlets, functions, providers, and external programs that are made available to connecting users.</span></span>

## <a name="determine-which-commands-to-allow"></a><span data-ttu-id="becd4-106">Ta reda på vilka kommandon som tillåts</span><span class="sxs-lookup"><span data-stu-id="becd4-106">Determine which commands to allow</span></span>

<span data-ttu-id="becd4-107">Det första steget i att skapa en roll kapacitets fil är att fundera över vad användarna behöver åtkomst till.</span><span class="sxs-lookup"><span data-stu-id="becd4-107">The first step in creating a role capability file is to consider what the users need access to.</span></span> <span data-ttu-id="becd4-108">Processen för att samla in krav kan ta en stund, men det är en viktig process.</span><span class="sxs-lookup"><span data-stu-id="becd4-108">The requirements gathering process can take a while, but it's an important process.</span></span> <span data-ttu-id="becd4-109">Att ge användare åtkomst till för få cmdlets och funktioner kan hindra dem från att få jobbet utfört.</span><span class="sxs-lookup"><span data-stu-id="becd4-109">Giving users access to too few cmdlets and functions can prevent them from getting their job done.</span></span> <span data-ttu-id="becd4-110">Att tillåta åtkomst till för många cmdletar och funktioner kan göra det möjligt för användare att göra mer än vad du avsåg och minska din säkerhets virtualiseringsprodukter från.</span><span class="sxs-lookup"><span data-stu-id="becd4-110">Allowing access to too many cmdlets and functions can allow users to do more than you intended and weaken your security stance.</span></span>

<span data-ttu-id="becd4-111">Hur du fortsätter med den här processen beror på din organisation och dina mål.</span><span class="sxs-lookup"><span data-stu-id="becd4-111">How you go about this process depends on your organization and goals.</span></span> <span data-ttu-id="becd4-112">Följande tips kan vara till hjälp för att se till att du har rätt sökväg.</span><span class="sxs-lookup"><span data-stu-id="becd4-112">The following tips can help ensure you're on the right path.</span></span>

1. <span data-ttu-id="becd4-113">**Identifiera** de kommandon som användare använder för att få jobben gjorda.</span><span class="sxs-lookup"><span data-stu-id="becd4-113">**Identify** the commands users are using to get their jobs done.</span></span> <span data-ttu-id="becd4-114">Detta kan innebära att undersöka IT-personal, kontrol lera automatiserings skript eller analysera PowerShell-sessions avskrifter och loggar.</span><span class="sxs-lookup"><span data-stu-id="becd4-114">This may involve surveying IT staff, checking automation scripts, or analyzing PowerShell session transcripts and logs.</span></span>
2. <span data-ttu-id="becd4-115">**Uppdatera** användningen av kommando rads verktyg till PowerShell-motsvarigheter, där det är möjligt, för den bästa gransknings-och Jea anpassnings upplevelsen.</span><span class="sxs-lookup"><span data-stu-id="becd4-115">**Update** use of command-line tools to PowerShell equivalents, where possible, for the best auditing and JEA customization experience.</span></span> <span data-ttu-id="becd4-116">Externa program kan inte vara begränsade som inbyggda PowerShell-cmdlets och Functions i JEA.</span><span class="sxs-lookup"><span data-stu-id="becd4-116">External programs can't be constrained as granularly as native PowerShell cmdlets and functions in JEA.</span></span>
3. <span data-ttu-id="becd4-117">**Begränsa** cmdlets definitions området så att endast vissa parametrar eller parameter värden tillåts.</span><span class="sxs-lookup"><span data-stu-id="becd4-117">**Restrict** the scope of the cmdlets to only allow specific parameters or parameter values.</span></span> <span data-ttu-id="becd4-118">Detta är särskilt viktigt om användarna endast ska hantera en del av ett system.</span><span class="sxs-lookup"><span data-stu-id="becd4-118">This is especially important if users should manage only part of a system.</span></span>
4. <span data-ttu-id="becd4-119">**Skapa** anpassade funktioner för att ersätta komplexa kommandon eller kommandon som är svåra att begränsa i Jea.</span><span class="sxs-lookup"><span data-stu-id="becd4-119">**Create** custom functions to replace complex commands or commands that are difficult to constrain in JEA.</span></span> <span data-ttu-id="becd4-120">En enkel funktion som omsluter ett komplext kommando eller använder ytterligare validerings logik kan ge ytterligare kontroll för administratörer och slutanvändarens enkelhet.</span><span class="sxs-lookup"><span data-stu-id="becd4-120">A simple function that wraps a complex command or applies additional validation logic can offer additional control for admins and end-user simplicity.</span></span>
5. <span data-ttu-id="becd4-121">**Testa** den begränsade listan över tillåtna kommandon med dina användare eller Automation-tjänster och justera efter behov.</span><span class="sxs-lookup"><span data-stu-id="becd4-121">**Test** the scoped list of allowable commands with your users or automation services, and adjust as necessary.</span></span>

### <a name="examples-of-potentially-dangerous-commands"></a><span data-ttu-id="becd4-122">Exempel på potentiellt farliga kommandon</span><span class="sxs-lookup"><span data-stu-id="becd4-122">Examples of potentially dangerous commands</span></span>

<span data-ttu-id="becd4-123">Ett noggrant urval av kommandon är viktigt för att se till att JEA-slutpunkten inte tillåter att användaren höjer sina behörigheter.</span><span class="sxs-lookup"><span data-stu-id="becd4-123">Careful selection of commands is important to ensure the JEA endpoint doesn't allow the user to elevate their permissions.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="becd4-124">Nödvändig information som krävs för användarens successCommands i en JEA-session körs ofta med utökade privilegier.</span><span class="sxs-lookup"><span data-stu-id="becd4-124">Essential information required for user successCommands in a JEA session are often run with elevated privileges.</span></span>

<span data-ttu-id="becd4-125">Följande tabell innehåller exempel på kommandon som kan användas skadligt om de tillåts i ett obegränsat tillstånd.</span><span class="sxs-lookup"><span data-stu-id="becd4-125">The following table contains examples of commands that can be used maliciously if allowed in an unconstrained state.</span></span> <span data-ttu-id="becd4-126">Detta är inte en fullständig lista och bör endast användas som en varnings start punkt.</span><span class="sxs-lookup"><span data-stu-id="becd4-126">This isn't an exhaustive list and should only be used as a cautionary starting point.</span></span>

|                                            <span data-ttu-id="becd4-127">Risk</span><span class="sxs-lookup"><span data-stu-id="becd4-127">Risk</span></span>                                            |                                <span data-ttu-id="becd4-128">Exempel</span><span class="sxs-lookup"><span data-stu-id="becd4-128">Example</span></span>                                |                                                                              <span data-ttu-id="becd4-129">Relaterade kommandon</span><span class="sxs-lookup"><span data-stu-id="becd4-129">Related commands</span></span>                                                                              |
| ------------------------------------------------------------------------------------------ | --------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <span data-ttu-id="becd4-130">Bevilja den anslutande användar administratörs behörighet att kringgå JEA</span><span class="sxs-lookup"><span data-stu-id="becd4-130">Granting the connecting user admin privileges to bypass JEA</span></span>                                | `Add-LocalGroupMember -Member 'CONTOSO\jdoe' -Group 'Administrators'` | <span data-ttu-id="becd4-131">`Add-ADGroupMember`, `Add-LocalGroupMember`, `net.exe`, `dsadd.exe`</span><span class="sxs-lookup"><span data-stu-id="becd4-131">`Add-ADGroupMember`, `Add-LocalGroupMember`, `net.exe`, `dsadd.exe`</span></span>                                                                                                        |
| <span data-ttu-id="becd4-132">Köra godtycklig kod, till exempel skadlig kod, sårbarheter eller anpassade skript för att kringgå skydd</span><span class="sxs-lookup"><span data-stu-id="becd4-132">Running arbitrary code, such as malware, exploits, or custom scripts to bypass protections</span></span> | `Start-Process -FilePath '\\san\share\malware.exe'`                   | <span data-ttu-id="becd4-133">`Start-Process`, `New-Service`, `Invoke-Item`, `Invoke-WmiMethod`, `Invoke-CimMethod`, `Invoke-Expression`, `Invoke-Command`, `New-ScheduledTask`, `Register-ScheduledJob`</span><span class="sxs-lookup"><span data-stu-id="becd4-133">`Start-Process`, `New-Service`, `Invoke-Item`, `Invoke-WmiMethod`, `Invoke-CimMethod`, `Invoke-Expression`, `Invoke-Command`, `New-ScheduledTask`, `Register-ScheduledJob`</span></span> |

## <a name="create-a-role-capability-file"></a><span data-ttu-id="becd4-134">Skapa en roll funktions fil</span><span class="sxs-lookup"><span data-stu-id="becd4-134">Create a role capability file</span></span>

<span data-ttu-id="becd4-135">Du kan skapa en ny funktion för PowerShell-roll med cmdleten [New-PSRoleCapabilityFile](/powershell/module/microsoft.powershell.core/new-psrolecapabilityfile?view=powershell-6) .</span><span class="sxs-lookup"><span data-stu-id="becd4-135">You can create a new PowerShell role capability file with the [New-PSRoleCapabilityFile](/powershell/module/microsoft.powershell.core/new-psrolecapabilityfile?view=powershell-6) cmdlet.</span></span>

```powershell
New-PSRoleCapabilityFile -Path .\MyFirstJEARole.psrc
```

<span data-ttu-id="becd4-136">Den resulterande roll funktions filen bör redige ras för att tillåta de kommandon som krävs för rollen.</span><span class="sxs-lookup"><span data-stu-id="becd4-136">The resulting role capability file should be edited to allow the commands required for the role.</span></span> <span data-ttu-id="becd4-137">PowerShell-hjälpens dokumentation innehåller flera exempel på hur du kan konfigurera filen.</span><span class="sxs-lookup"><span data-stu-id="becd4-137">The PowerShell help documentation contains several examples of how you can configure the file.</span></span>

### <a name="allowing-powershell-cmdlets-and-functions"></a><span data-ttu-id="becd4-138">Tillåta PowerShell-cmdlets och Functions</span><span class="sxs-lookup"><span data-stu-id="becd4-138">Allowing PowerShell cmdlets and functions</span></span>

<span data-ttu-id="becd4-139">Om du vill auktorisera användare att köra PowerShell-cmdletar eller-funktioner lägger du till cmdleten eller funktions namnet i fälten VisibleCmdlets eller VisibleFunctions.</span><span class="sxs-lookup"><span data-stu-id="becd4-139">To authorize users to run PowerShell cmdlets or functions, add the cmdlet or function name to the VisibleCmdlets or VisibleFunctions fields.</span></span> <span data-ttu-id="becd4-140">Om du inte är säker på om ett kommando är en cmdlet eller funktion kan du köra `Get-Command <name>` och kontrol lera egenskapen **CommandType** i utdata.</span><span class="sxs-lookup"><span data-stu-id="becd4-140">If you aren't sure whether a command is a cmdlet or function, you can run `Get-Command <name>` and check the **CommandType** property in the output.</span></span>

```powershell
VisibleCmdlets = 'Restart-Computer', 'Get-NetIPAddress'
```

<span data-ttu-id="becd4-141">Ibland är omfattningen av en speciell cmdlet eller funktion för bred för användarnas behov.</span><span class="sxs-lookup"><span data-stu-id="becd4-141">Sometimes the scope of a specific cmdlet or function is too broad for your users' needs.</span></span> <span data-ttu-id="becd4-142">En DNS-administratör, till exempel, behöver förmodligen bara åtkomst för att starta om DNS-tjänsten.</span><span class="sxs-lookup"><span data-stu-id="becd4-142">A DNS admin, for example, probably only needs access to restart the DNS service.</span></span> <span data-ttu-id="becd4-143">I miljöer med flera klienter har klienter till gång till självbetjänings hanterings verktyg.</span><span class="sxs-lookup"><span data-stu-id="becd4-143">In multi-tenant environments, tenants have access to self-service management tools.</span></span> <span data-ttu-id="becd4-144">Klienterna bör begränsas till att hantera sina egna resurser.</span><span class="sxs-lookup"><span data-stu-id="becd4-144">Tenants should be limited to managing their own resources.</span></span> <span data-ttu-id="becd4-145">I dessa fall kan du begränsa vilka parametrar som exponeras från cmdleten eller funktionen.</span><span class="sxs-lookup"><span data-stu-id="becd4-145">For these cases, you can restrict which parameters are exposed from the cmdlet or function.</span></span>

```powershell
VisibleCmdlets = @{ Name = 'Restart-Computer'; Parameters = @{ Name = 'Name' }}
```

<span data-ttu-id="becd4-146">I mer avancerade scenarier kan du också behöva begränsa de värden som en användare kan använda med dessa parametrar.</span><span class="sxs-lookup"><span data-stu-id="becd4-146">In more advanced scenarios, you may also need to restrict the values a user may use with these parameters.</span></span> <span data-ttu-id="becd4-147">Med roll funktioner kan du definiera en uppsättning värden eller ett mönster för reguljära uttryck som avgör vilka indatatyper som tillåts.</span><span class="sxs-lookup"><span data-stu-id="becd4-147">Role capabilities let you define a set of values or a regular expression pattern that determine what input is allowed.</span></span>

```powershell
VisibleCmdlets = @{ Name = 'Restart-Service'; Parameters = @{ Name = 'Name'; ValidateSet = 'Dns', 'Spooler' }},
                 @{ Name = 'Start-Website'; Parameters = @{ Name = 'Name'; ValidatePattern = 'HR_*' }}
```

> [!NOTE]
> <span data-ttu-id="becd4-148">[Vanliga PowerShell-parametrar](/powershell/module/microsoft.powershell.core/about/about_commonparameters) tillåts alltid, även om du begränsar de tillgängliga parametrarna.</span><span class="sxs-lookup"><span data-stu-id="becd4-148">The [common PowerShell parameters](/powershell/module/microsoft.powershell.core/about/about_commonparameters) are always allowed, even if you restrict the available parameters.</span></span>
> <span data-ttu-id="becd4-149">Du bör inte uttryckligen lista dem i parameter fältet.</span><span class="sxs-lookup"><span data-stu-id="becd4-149">You should not explicitly list them in the Parameters field.</span></span>

<span data-ttu-id="becd4-150">I tabellen nedan beskrivs de olika sätt som du kan anpassa en synlig cmdlet eller funktion på.</span><span class="sxs-lookup"><span data-stu-id="becd4-150">The table below describes the various ways you can customize a visible cmdlet or function.</span></span>
<span data-ttu-id="becd4-151">Du kan blanda och matcha något av följande i fältet **VisibleCmdlets** .</span><span class="sxs-lookup"><span data-stu-id="becd4-151">You can mix and match any of the below in the **VisibleCmdlets** field.</span></span>

|                                           <span data-ttu-id="becd4-152">Exempel</span><span class="sxs-lookup"><span data-stu-id="becd4-152">Example</span></span>                                           |                                                             <span data-ttu-id="becd4-153">Användningsfall</span><span class="sxs-lookup"><span data-stu-id="becd4-153">Use case</span></span>                                                              |
| ------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------- |
| <span data-ttu-id="becd4-154">`'My-Func'` eller `@{ Name = 'My-Func' }`</span><span class="sxs-lookup"><span data-stu-id="becd4-154">`'My-Func'` or `@{ Name = 'My-Func' }`</span></span>                                                      | <span data-ttu-id="becd4-155">Tillåter att användaren kör `My-Func` utan begränsningar för parametrarna.</span><span class="sxs-lookup"><span data-stu-id="becd4-155">Allows the user to run `My-Func` without any restrictions on the parameters.</span></span>                                                      |
| `'MyModule\My-Func'`                                                                        | <span data-ttu-id="becd4-156">Gör att användaren kan köra `My-Func` från modulen `MyModule` utan begränsningar för parametrarna.</span><span class="sxs-lookup"><span data-stu-id="becd4-156">Allows the user to run `My-Func` from the module `MyModule` without any restrictions on the parameters.</span></span>                           |
| `'My-*'`                                                                                    | <span data-ttu-id="becd4-157">Tillåter användaren att köra valfri cmdlet eller funktion med verb `My`.</span><span class="sxs-lookup"><span data-stu-id="becd4-157">Allows the user to run any cmdlet or function with the verb `My`.</span></span>                                                                 |
| `'*-Func'`                                                                                  | <span data-ttu-id="becd4-158">Tillåter användaren att köra valfri cmdlet eller funktion med Substantiv `Func`.</span><span class="sxs-lookup"><span data-stu-id="becd4-158">Allows the user to run any cmdlet or function with the noun `Func`.</span></span>                                                               |
| `@{ Name = 'My-Func'; Parameters = @{ Name = 'Param1'}, @{ Name = 'Param2' }}`              | <span data-ttu-id="becd4-159">Tillåter att användaren kör `My-Func` med parametrarna `Param1` och `Param2`.</span><span class="sxs-lookup"><span data-stu-id="becd4-159">Allows the user to run `My-Func` with the `Param1` and `Param2` parameters.</span></span> <span data-ttu-id="becd4-160">Alla värden kan anges för parametrarna.</span><span class="sxs-lookup"><span data-stu-id="becd4-160">Any value can be supplied to the parameters.</span></span>          |
| `@{ Name = 'My-Func'; Parameters = @{ Name = 'Param1'; ValidateSet = 'Value1', 'Value2' }}` | <span data-ttu-id="becd4-161">Tillåter att användaren kör `My-Func` med parametern `Param1`.</span><span class="sxs-lookup"><span data-stu-id="becd4-161">Allows the user to run `My-Func` with the `Param1` parameter.</span></span> <span data-ttu-id="becd4-162">Endast "värde1" och "värde2" kan anges för parametern.</span><span class="sxs-lookup"><span data-stu-id="becd4-162">Only "Value1" and "Value2" can be supplied to the parameter.</span></span>        |
| `@{ Name = 'My-Func'; Parameters = @{ Name = 'Param1'; ValidatePattern = 'contoso.*' }}`    | <span data-ttu-id="becd4-163">Tillåter att användaren kör `My-Func` med parametern `Param1`.</span><span class="sxs-lookup"><span data-stu-id="becd4-163">Allows the user to run `My-Func` with the `Param1` parameter.</span></span> <span data-ttu-id="becd4-164">Alla värden som börjar med "contoso" kan anges för parametern.</span><span class="sxs-lookup"><span data-stu-id="becd4-164">Any value starting with "contoso" can be supplied to the parameter.</span></span> |

> [!WARNING]
> <span data-ttu-id="becd4-165">För bästa säkerhets praxis rekommenderar vi inte att jokertecken används när du definierar synliga cmdlets eller functions.</span><span class="sxs-lookup"><span data-stu-id="becd4-165">For best security practices, it is not recommended to use wildcards when defining visible cmdlets or functions.</span></span> <span data-ttu-id="becd4-166">I stället bör du uttryckligen lista varje betrott kommando för att se till att inga andra kommandon som delar samma namngivnings schema oavsiktligt har behörighet.</span><span class="sxs-lookup"><span data-stu-id="becd4-166">Instead, you should explicitly list each trusted command to ensure no other commands that share the same naming scheme are unintentionally authorized.</span></span>

<span data-ttu-id="becd4-167">Du kan inte använda både en **ValidatePattern** och **ValidateSet** för samma cmdlet eller funktion.</span><span class="sxs-lookup"><span data-stu-id="becd4-167">You can't apply both a **ValidatePattern** and **ValidateSet** to the same cmdlet or function.</span></span>

<span data-ttu-id="becd4-168">Om du gör det åsidosätter **ValidatePattern** **ValidateSet**.</span><span class="sxs-lookup"><span data-stu-id="becd4-168">If you do, the **ValidatePattern** overrides the **ValidateSet**.</span></span>

<span data-ttu-id="becd4-169">Mer information om **ValidatePattern**finns i [det här *Hey, Scripting Guy!* post](https://devblogs.microsoft.com/scripting/validate-powershell-parameters-before-running-the-script/) och PowerShell-referensen för [vanliga uttryck](/powershell/module/microsoft.powershell.core/about/about_regular_expressions) .</span><span class="sxs-lookup"><span data-stu-id="becd4-169">For more information about **ValidatePattern**, check out [this *Hey, Scripting Guy!* post](https://devblogs.microsoft.com/scripting/validate-powershell-parameters-before-running-the-script/) and the [PowerShell Regular Expressions](/powershell/module/microsoft.powershell.core/about/about_regular_expressions) reference content.</span></span>

### <a name="allowing-external-commands-and-powershell-scripts"></a><span data-ttu-id="becd4-170">Tillåta externa kommandon och PowerShell-skript</span><span class="sxs-lookup"><span data-stu-id="becd4-170">Allowing external commands and PowerShell scripts</span></span>

<span data-ttu-id="becd4-171">Om du vill tillåta användare att köra körbara filer och PowerShell-skript (. ps1) i en JEA-session måste du lägga till den fullständiga sökvägen till varje program i fältet **VisibleExternalCommands** .</span><span class="sxs-lookup"><span data-stu-id="becd4-171">To allow users to run executables and PowerShell scripts (.ps1) in a JEA session, you have to add the full path to each program in the **VisibleExternalCommands** field.</span></span>

```powershell
VisibleExternalCommands = 'C:\Windows\System32\whoami.exe', 'C:\Program Files\Contoso\Scripts\UpdateITSoftware.ps1'
```

<span data-ttu-id="becd4-172">Om möjligt kan du använda PowerShell-cmdlet eller Function-motsvarigheter för alla externa körbara filer som du godkänner eftersom du har kontroll över de parametrar som tillåts med PowerShell-cmdlets och functions.</span><span class="sxs-lookup"><span data-stu-id="becd4-172">Where possible, to use PowerShell cmdlet or function equivalents for any external executables you authorize since you have control over the parameters allowed with PowerShell cmdlets and functions.</span></span>

<span data-ttu-id="becd4-173">Med många körbara filer kan du läsa det aktuella läget och sedan ändra det genom att ange olika parametrar.</span><span class="sxs-lookup"><span data-stu-id="becd4-173">Many executables allow you to read the current state and then change it by providing different parameters.</span></span>

<span data-ttu-id="becd4-174">Anta till exempel rollen som en fil Server administratör som hanterar nätverks resurser som finns på ett system.</span><span class="sxs-lookup"><span data-stu-id="becd4-174">For example, consider the role of a file server admin that manages network shares hosted on a system.</span></span> <span data-ttu-id="becd4-175">Ett sätt att hantera resurser är att använda `net share`.</span><span class="sxs-lookup"><span data-stu-id="becd4-175">One way of managing shares is to use `net share`.</span></span> <span data-ttu-id="becd4-176">Att tillåta **net. exe** är dock farligt eftersom användaren kan använda kommandot för att få administratörs behörighet med `net group Administrators unprivilegedjeauser /add`.</span><span class="sxs-lookup"><span data-stu-id="becd4-176">However, allowing **net.exe** is dangerous because the user could use the command to gain admin privileges with `net group Administrators unprivilegedjeauser /add`.</span></span> <span data-ttu-id="becd4-177">Ett säkrare alternativ är att tillåta [Get-SmbShare](/powershell/module/smbshare/get-smbshare), vilket ger samma resultat men har ett mycket mer begränsat omfång.</span><span class="sxs-lookup"><span data-stu-id="becd4-177">A more secure option is to allow [Get-SmbShare](/powershell/module/smbshare/get-smbshare), which achieves the same result but has a much more limited scope.</span></span>

<span data-ttu-id="becd4-178">När du gör externa kommandon tillgängliga för användare i en JEA-session ska du alltid ange den fullständiga sökvägen till den körbara filen.</span><span class="sxs-lookup"><span data-stu-id="becd4-178">When making external commands available to users in a JEA session, always specify the complete path to the executable.</span></span> <span data-ttu-id="becd4-179">Detta förhindrar körning av liknande namngivna och potentiellt skadliga program som finns på andra platser i systemet.</span><span class="sxs-lookup"><span data-stu-id="becd4-179">This prevents the execution of similarly named and potentially malicious programs located elsewhere on the system.</span></span>

### <a name="allowing-access-to-powershell-providers"></a><span data-ttu-id="becd4-180">Tillåta åtkomst till PowerShell-leverantörer</span><span class="sxs-lookup"><span data-stu-id="becd4-180">Allowing access to PowerShell providers</span></span>

<span data-ttu-id="becd4-181">Som standard är inga PowerShell-leverantörer tillgängliga i JEA-sessioner.</span><span class="sxs-lookup"><span data-stu-id="becd4-181">By default, no PowerShell providers are available in JEA sessions.</span></span> <span data-ttu-id="becd4-182">Detta minskar risken för känslig information och konfigurations inställningar som visas för den anslutande användaren.</span><span class="sxs-lookup"><span data-stu-id="becd4-182">This reduces the risk of sensitive information and configuration settings being disclosed to the connecting user.</span></span>

<span data-ttu-id="becd4-183">Vid behov kan du ge åtkomst till PowerShell-providers med hjälp av kommandot `VisibleProviders`.</span><span class="sxs-lookup"><span data-stu-id="becd4-183">When necessary, you can allow access to the PowerShell providers using the `VisibleProviders` command.</span></span> <span data-ttu-id="becd4-184">För en fullständig lista över leverantörer, kör `Get-PSProvider`.</span><span class="sxs-lookup"><span data-stu-id="becd4-184">For a full list of providers, run `Get-PSProvider`.</span></span>

```powershell
VisibleProviders = 'Registry'
```

<span data-ttu-id="becd4-185">För enkla uppgifter som kräver åtkomst till fil systemet, registret, certifikat arkivet eller andra känsliga leverantörer kan du överväga att skriva en anpassad funktion som fungerar med providern för användarens räkning.</span><span class="sxs-lookup"><span data-stu-id="becd4-185">For simple tasks that require access to the file system, registry, certificate store, or other sensitive providers, consider writing a custom function that works with the provider on the user's behalf.</span></span> <span data-ttu-id="becd4-186">De funktioner, cmdletar och externa program som är tillgängliga i en JEA-session omfattas inte av samma begränsningar som JEA.</span><span class="sxs-lookup"><span data-stu-id="becd4-186">The functions, cmdlets, and external programs available in a JEA session aren't subject to the same constraints as JEA.</span></span> <span data-ttu-id="becd4-187">De kan komma åt alla leverantörer som standard.</span><span class="sxs-lookup"><span data-stu-id="becd4-187">They can access any provider by default.</span></span> <span data-ttu-id="becd4-188">Överväg också att använda [användar enheten](session-configurations.md#user-drive) när du kopierar filer till eller från en Jea-slutpunkt krävs.</span><span class="sxs-lookup"><span data-stu-id="becd4-188">Also consider using the [user drive](session-configurations.md#user-drive) when copying files to or from a JEA endpoint is required.</span></span>

### <a name="creating-custom-functions"></a><span data-ttu-id="becd4-189">Skapa anpassade funktioner</span><span class="sxs-lookup"><span data-stu-id="becd4-189">Creating custom functions</span></span>

<span data-ttu-id="becd4-190">Du kan skapa anpassade funktioner i en roll funktions fil för att förenkla komplexa uppgifter för slutanvändarna.</span><span class="sxs-lookup"><span data-stu-id="becd4-190">You can author custom functions in a role capability file to simplify complex tasks for your end users.</span></span> <span data-ttu-id="becd4-191">Anpassade funktioner är också användbara när du behöver avancerad validerings logik för cmdlet-parametervärdena.</span><span class="sxs-lookup"><span data-stu-id="becd4-191">Custom functions are also useful when you require advanced validation logic for cmdlet parameter values.</span></span> <span data-ttu-id="becd4-192">Du kan skriva enkla funktioner i fältet **FunctionDefinitions** :</span><span class="sxs-lookup"><span data-stu-id="becd4-192">You can write simple functions in the **FunctionDefinitions** field:</span></span>

```powershell
VisibleFunctions = 'Get-TopProcess'

FunctionDefinitions = @{
    Name = 'Get-TopProcess'

    ScriptBlock = {
        param($Count = 10)

        Get-Process | Sort-Object -Property CPU -Descending |
            Microsoft.PowerShell.Utility\Select-Object -First $Count
    }
}
```

> [!IMPORTANT]
> <span data-ttu-id="becd4-193">Glöm inte att lägga till namnet på dina anpassade funktioner i fältet **VisibleFunctions** så att de kan köras av Jea-användare.</span><span class="sxs-lookup"><span data-stu-id="becd4-193">Don't forget to add the name of your custom functions to the **VisibleFunctions** field so they can be run by the JEA users.</span></span>

<span data-ttu-id="becd4-194">Texten (skript blocket) för anpassade funktioner körs i standard språk läge för systemet och omfattas inte av JEA språk begränsningar.</span><span class="sxs-lookup"><span data-stu-id="becd4-194">The body (script block) of custom functions runs in the default language mode for the system and isn't subject to JEA's language constraints.</span></span> <span data-ttu-id="becd4-195">Det innebär att funktioner kan komma åt fil systemet och registret, och köra kommandon som inte har gjorts synliga i den roll kapacitets filen.</span><span class="sxs-lookup"><span data-stu-id="becd4-195">This means that functions can access the file system and registry, and run commands that weren't made visible in the role capability file.</span></span> <span data-ttu-id="becd4-196">Ta hand om att undvika att köra godtycklig kod när du använder parametrar.</span><span class="sxs-lookup"><span data-stu-id="becd4-196">Take care to avoid running arbitrary code when using parameters.</span></span> <span data-ttu-id="becd4-197">Undvik att skicka indata från användaren direkt till cmdlets som `Invoke-Expression`.</span><span class="sxs-lookup"><span data-stu-id="becd4-197">Avoid piping user input directly into cmdlets like `Invoke-Expression`.</span></span>

<span data-ttu-id="becd4-198">I exemplet ovan ser du att det fullständigt kvalificerade modulnamnet (FQMN) `Microsoft.PowerShell.Utility\Select-Object` användes i stället för det stenografiska `Select-Object`.</span><span class="sxs-lookup"><span data-stu-id="becd4-198">In the above example, notice that the fully qualified module name (FQMN) `Microsoft.PowerShell.Utility\Select-Object` was used instead of the shorthand `Select-Object`.</span></span>
<span data-ttu-id="becd4-199">Funktioner som definieras i roll kapacitets filer omfattas fortfarande av omfånget för JEA-sessioner, som innehåller proxy-funktionerna JEA skapar för att begränsa befintliga kommandon.</span><span class="sxs-lookup"><span data-stu-id="becd4-199">Functions defined in role capability files are still subject to the scope of JEA sessions, which includes the proxy functions JEA creates to constrain existing commands.</span></span>

<span data-ttu-id="becd4-200">Som standard är `Select-Object` en begränsad cmdlet i alla JEA-sessioner som inte tillåter val av godtyckliga egenskaper för objekt.</span><span class="sxs-lookup"><span data-stu-id="becd4-200">By default, `Select-Object` is a constrained cmdlet in all JEA sessions that doesn't allow the selection of arbitrary properties on objects.</span></span> <span data-ttu-id="becd4-201">Om du vill använda den obegränsade `Select-Object` i functions måste du uttryckligen begära den fullständiga implementeringen med hjälp av FQMN.</span><span class="sxs-lookup"><span data-stu-id="becd4-201">To use the unconstrained `Select-Object` in functions, you must explicitly request the full implementation using the FQMN.</span></span> <span data-ttu-id="becd4-202">Alla begränsade cmdlets i en JEA-session har samma begränsningar när de anropas från en funktion.</span><span class="sxs-lookup"><span data-stu-id="becd4-202">Any constrained cmdlet in a JEA session has the same constraints when invoked from a function.</span></span> <span data-ttu-id="becd4-203">Mer information finns i [about_Command_Precedence](/powershell/module/microsoft.powershell.core/about/about_command_precedence).</span><span class="sxs-lookup"><span data-stu-id="becd4-203">For more information, see [about_Command_Precedence](/powershell/module/microsoft.powershell.core/about/about_command_precedence).</span></span>

<span data-ttu-id="becd4-204">Om du skriver flera anpassade funktioner är det mer praktiskt att använda dem i en PowerShell-modul för-skript.</span><span class="sxs-lookup"><span data-stu-id="becd4-204">If you're writing several custom functions, it's more convenient to put them in a PowerShell script module.</span></span> <span data-ttu-id="becd4-205">Du gör dessa funktioner synliga i JEA-sessionen med hjälp av **VisibleFunctions** -fältet på samma sätt som med inbyggda moduler och moduler från tredje part.</span><span class="sxs-lookup"><span data-stu-id="becd4-205">You make those functions visible in the JEA session using the **VisibleFunctions** field like you would with built-in and third-party modules.</span></span>

<span data-ttu-id="becd4-206">För att avslutning av flikar ska fungera korrekt i JEA-sessioner måste du inkludera den inbyggda funktionen `tabexpansion2` i **VisibleFunctions** -listan.</span><span class="sxs-lookup"><span data-stu-id="becd4-206">For tab completion to work properly in JEA sessions you must include the built-in function `tabexpansion2` in the **VisibleFunctions** list.</span></span>

## <a name="make-the-role-capabilities-available-to-a-configuration"></a><span data-ttu-id="becd4-207">Gör roll funktionerna tillgängliga för en konfiguration</span><span class="sxs-lookup"><span data-stu-id="becd4-207">Make the role capabilities available to a configuration</span></span>

<span data-ttu-id="becd4-208">Innan PowerShell 6, för PowerShell för att hitta en roll kapacitets fil, måste den lagras i en **RoleCapabilities** -mapp i en PowerShell-modul.</span><span class="sxs-lookup"><span data-stu-id="becd4-208">Prior to PowerShell 6, for PowerShell to find a role capability file it must be stored in a **RoleCapabilities** folder in a PowerShell module.</span></span> <span data-ttu-id="becd4-209">Modulen kan lagras i en mapp som ingår i `$env:PSModulePath`-miljövariabeln, men du bör inte placera den i `$env:SystemRoot\System32` eller en mapp där obetrodda användare kan ändra filerna.</span><span class="sxs-lookup"><span data-stu-id="becd4-209">The module can be stored in any folder included in the `$env:PSModulePath` environment variable, however you shouldn't place it in `$env:SystemRoot\System32` or a folder where untrusted users could modify the files.</span></span>

<span data-ttu-id="becd4-210">I följande exempel skapas en PowerShell-modul med namnet **ContosoJEA** i `$env:ProgramFiles` sökvägen som värd för roll funktions filen.</span><span class="sxs-lookup"><span data-stu-id="becd4-210">The following example creates a PowerShell script module called **ContosoJEA** in the `$env:ProgramFiles` path to host the role capabilities file.</span></span>

```powershell
# Create a folder for the module
$modulePath = Join-Path $env:ProgramFiles "WindowsPowerShell\Modules\ContosoJEA"
New-Item -ItemType Directory -Path $modulePath

# Create an empty script module and module manifest.
# At least one file in the module folder must have the same name as the folder itself.
New-Item -ItemType File -Path (Join-Path $modulePath "ContosoJEAFunctions.psm1")
New-ModuleManifest -Path (Join-Path $modulePath "ContosoJEA.psd1") -RootModule "ContosoJEAFunctions.psm1"

# Create the RoleCapabilities folder and copy in the PSRC file
$rcFolder = Join-Path $modulePath "RoleCapabilities"
New-Item -ItemType Directory $rcFolder
Copy-Item -Path .\MyFirstJEARole.psrc -Destination $rcFolder
```

<span data-ttu-id="becd4-211">Mer information om PowerShell-moduler finns i [förstå en PowerShell-modul](/powershell/scripting/developer/windows-powershell).</span><span class="sxs-lookup"><span data-stu-id="becd4-211">For more information about PowerShell modules, see [Understanding a PowerShell Module](/powershell/scripting/developer/windows-powershell).</span></span>

<span data-ttu-id="becd4-212">Från och med PowerShell 6 lades egenskapen **RoleDefinitions** till i konfigurations filen för sessionen.</span><span class="sxs-lookup"><span data-stu-id="becd4-212">Starting in PowerShell 6, the **RoleDefinitions** property was added to the session configuration file.</span></span> <span data-ttu-id="becd4-213">Med den här egenskapen kan du ange platsen för en roll konfigurations fil för roll definitionen.</span><span class="sxs-lookup"><span data-stu-id="becd4-213">This property lets you specify the location of a role configuration file for your role definition.</span></span> <span data-ttu-id="becd4-214">Se exemplen i [New-PSSessionConfigurationFile](/powershell/module/microsoft.powershell.core/new-pssessionconfigurationfile).</span><span class="sxs-lookup"><span data-stu-id="becd4-214">See the examples in [New-PSSessionConfigurationFile](/powershell/module/microsoft.powershell.core/new-pssessionconfigurationfile).</span></span>

## <a name="updating-role-capabilities"></a><span data-ttu-id="becd4-215">Uppdaterar roll funktioner</span><span class="sxs-lookup"><span data-stu-id="becd4-215">Updating role capabilities</span></span>

<span data-ttu-id="becd4-216">Du kan redigera en roll funktions fil om du vill uppdatera inställningarna när som helst.</span><span class="sxs-lookup"><span data-stu-id="becd4-216">You can edit a role capability file to update the settings at any time.</span></span> <span data-ttu-id="becd4-217">Alla nya JEA-sessioner som startas efter att roll kapaciteten har uppdaterats visar de ändrade funktionerna.</span><span class="sxs-lookup"><span data-stu-id="becd4-217">Any new JEA sessions started after the role capability has been updated will reflect the revised capabilities.</span></span>

<span data-ttu-id="becd4-218">Det är därför viktigt att kontrol lera åtkomsten till mappen roll funktioner.</span><span class="sxs-lookup"><span data-stu-id="becd4-218">This is why controlling access to the role capabilities folder is so important.</span></span> <span data-ttu-id="becd4-219">Endast hög betrodda administratörer bör kunna ändra roll kapacitets filer.</span><span class="sxs-lookup"><span data-stu-id="becd4-219">Only highly trusted administrators should be allowed to change role capability files.</span></span> <span data-ttu-id="becd4-220">Om en ej betrodd användare kan ändra roll kapacitets filer kan de enkelt ge sig till gång till cmdletar som gör att de kan höja sina privilegier.</span><span class="sxs-lookup"><span data-stu-id="becd4-220">If an untrusted user can change role capability files, they can easily give themselves access to cmdlets that allow them to elevate their privileges.</span></span>

<span data-ttu-id="becd4-221">För administratörer som vill låsa åtkomst till roll funktionerna kontrollerar du att lokalt system har Läs behörighet till roll kapacitets filerna och innehåller moduler.</span><span class="sxs-lookup"><span data-stu-id="becd4-221">For administrators looking to lock down access to the role capabilities, ensure Local System has read access to the role capability files and containing modules.</span></span>

## <a name="how-role-capabilities-are-merged"></a><span data-ttu-id="becd4-222">Så här sammanfogas roll funktioner</span><span class="sxs-lookup"><span data-stu-id="becd4-222">How role capabilities are merged</span></span>

<span data-ttu-id="becd4-223">Användare beviljas åtkomst till alla matchande roll funktioner i [konfigurations filen för sessionen](session-configurations.md) när de anger en Jea-session.</span><span class="sxs-lookup"><span data-stu-id="becd4-223">Users are granted access to all matching role capabilities in the [session configuration file](session-configurations.md) when they enter a JEA session.</span></span> <span data-ttu-id="becd4-224">JEA försöker ge användaren den mest tillåtna uppsättningen kommandon som tillåts av någon av rollerna.</span><span class="sxs-lookup"><span data-stu-id="becd4-224">JEA tries to give the user the most permissive set of commands allowed by any of the roles.</span></span>

### <a name="visiblecmdlets-and-visiblefunctions"></a><span data-ttu-id="becd4-225">VisibleCmdlets och VisibleFunctions</span><span class="sxs-lookup"><span data-stu-id="becd4-225">VisibleCmdlets and VisibleFunctions</span></span>

<span data-ttu-id="becd4-226">Den mest komplexa sammanslagnings logiken påverkar cmdletar och funktioner, vilket kan ha sina parametrar och parameter värden begränsade i JEA.</span><span class="sxs-lookup"><span data-stu-id="becd4-226">The most complex merge logic affects cmdlets and functions, which can have their parameters and parameter values limited in JEA.</span></span>

<span data-ttu-id="becd4-227">Reglerna är följande:</span><span class="sxs-lookup"><span data-stu-id="becd4-227">The rules are as follows:</span></span>

1. <span data-ttu-id="becd4-228">Om en cmdlet bara görs synlig i en roll, är den synlig för användaren med eventuella tillämpliga parameter begränsningar.</span><span class="sxs-lookup"><span data-stu-id="becd4-228">If a cmdlet is only made visible in one role, it is visible to the user with any applicable parameter constraints.</span></span>
2. <span data-ttu-id="becd4-229">Om en cmdlet görs synlig i mer än en roll och varje roll har samma begränsningar i cmdleten, visas cmdleten för användaren med dessa begränsningar.</span><span class="sxs-lookup"><span data-stu-id="becd4-229">If a cmdlet is made visible in more than one role, and each role has the same constraints on the cmdlet, the cmdlet is visible to the user with those constraints.</span></span>
3. <span data-ttu-id="becd4-230">Om en cmdlet görs synlig i mer än en roll, och varje roll tillåter en annan uppsättning parametrar, visas cmdleten och alla parametrar som definierats för varje roll för användaren.</span><span class="sxs-lookup"><span data-stu-id="becd4-230">If a cmdlet is made visible in more than one role, and each role allows a different set of parameters, the cmdlet and all the parameters defined across every role are visible to the user.</span></span>
   <span data-ttu-id="becd4-231">Om en roll inte har begränsningar för parametrarna, tillåts alla parametrar.</span><span class="sxs-lookup"><span data-stu-id="becd4-231">If one role doesn't have constraints on the parameters, all parameters are allowed.</span></span>
4. <span data-ttu-id="becd4-232">Om en roll definierar en verifierad uppsättning eller verifiera mönster för en cmdlet-parameter, och den andra rollen tillåter parametern men inte begränsar parameter värden, ignoreras verifierings uppsättningen eller mönstret.</span><span class="sxs-lookup"><span data-stu-id="becd4-232">If one role defines a validate set or validate pattern for a cmdlet parameter, and the other role allows the parameter but does not constrain the parameter values, the validate set or pattern is ignored.</span></span>
5. <span data-ttu-id="becd4-233">Om en verifierings uppsättning har definierats för samma cmdlet-parameter i mer än en roll, tillåts alla värden från alla validerings uppsättningar.</span><span class="sxs-lookup"><span data-stu-id="becd4-233">If a validate set is defined for the same cmdlet parameter in more than one role, all values from all validate sets are allowed.</span></span>
6. <span data-ttu-id="becd4-234">Om ett verifierings mönster har definierats för samma cmdlet-parameter i mer än en roll, tillåts alla värden som matchar någon av mönstren.</span><span class="sxs-lookup"><span data-stu-id="becd4-234">If a validate pattern is defined for the same cmdlet parameter in more than one role, any values that match any of the patterns are allowed.</span></span>
7. <span data-ttu-id="becd4-235">Om en verifierings uppsättning definieras i en eller flera roller, och ett verifierings mönster definieras i en annan roll för samma cmdlet-parameter, ignoreras verifierings uppsättningen och regel (6) gäller för de återstående verifierings mönstren.</span><span class="sxs-lookup"><span data-stu-id="becd4-235">If a validate set is defined in one or more roles, and a validate pattern is defined in another role for the same cmdlet parameter, the validate set is ignored and rule (6) applies to the remaining validate patterns.</span></span>

<span data-ttu-id="becd4-236">Nedan visas ett exempel på hur roller slås samman enligt följande regler:</span><span class="sxs-lookup"><span data-stu-id="becd4-236">Below is an example of how roles are merged according to these rules:</span></span>

```powershell
# Role A Visible Cmdlets
$roleA = @{
    VisibleCmdlets = 'Get-Service',
                     @{ Name = 'Restart-Service';
                        Parameters = @{ Name = 'DisplayName'; ValidateSet = 'DNS Client' } }
}

# Role B Visible Cmdlets
$roleB = @{
    VisibleCmdlets = @{ Name = 'Get-Service';
                        Parameters = @{ Name = 'DisplayName'; ValidatePattern = 'DNS.*' } },
                     @{ Name = 'Restart-Service';
                        Parameters = @{ Name = 'DisplayName'; ValidateSet = 'DNS Server' } }
}

# Resulting permissions for a user who belongs to both role A and B
# - The constraint in role B for the DisplayName parameter on Get-Service
#   is ignored because of rule #4
# - The ValidateSets for Restart-Service are merged because both roles use
#   ValidateSet on the same parameter per rule #5
$mergedAandB = @{
    VisibleCmdlets = 'Get-Service',
                     @{ Name = 'Restart-Service';
                        Parameters = @{ Name = 'DisplayName'; ValidateSet = 'DNS Client', 'DNS Server' } }
}
```

### <a name="visibleexternalcommands-visiblealiases-visibleproviders-scriptstoprocess"></a><span data-ttu-id="becd4-237">VisibleExternalCommands, VisibleAliases, VisibleProviders, ScriptsToProcess</span><span class="sxs-lookup"><span data-stu-id="becd4-237">VisibleExternalCommands, VisibleAliases, VisibleProviders, ScriptsToProcess</span></span>

<span data-ttu-id="becd4-238">Alla andra fält i roll kapacitets filen läggs till i en kumulativ uppsättning tillåtna externa kommandon, alias, providers och start skript.</span><span class="sxs-lookup"><span data-stu-id="becd4-238">All other fields in the role capability file are added to a cumulative set of allowable external commands, aliases, providers, and startup scripts.</span></span> <span data-ttu-id="becd4-239">Alla kommandon, alias, providers och skript som är tillgängliga i en roll kapacitet är tillgängliga för JEA-användaren.</span><span class="sxs-lookup"><span data-stu-id="becd4-239">Any command, alias, provider, or script available in one role capability is available to the JEA user.</span></span>

<span data-ttu-id="becd4-240">Var noga med att se till att den kombinerade uppsättningen med providers från en roll kapacitet och cmdlets/Functions/commands från andra inte tillåter användare oavsiktlig åtkomst till system resurser.</span><span class="sxs-lookup"><span data-stu-id="becd4-240">Be careful to ensure that the combined set of providers from one role capability and cmdlets/functions/commands from another don't allow users unintentional access to system resources.</span></span>
<span data-ttu-id="becd4-241">Om en roll till exempel tillåter `Remove-Item`-cmdleten och en annan tillåter `FileSystem` leverantören, riskerar du att en JEA användare tar bort godtyckliga filer på datorn.</span><span class="sxs-lookup"><span data-stu-id="becd4-241">For example, if one role allows the `Remove-Item` cmdlet and another allows the `FileSystem` provider, you are at risk of a JEA user deleting arbitrary files on your computer.</span></span> <span data-ttu-id="becd4-242">Ytterligare information om att identifiera användares gällande behörigheter finns i artikeln [granskning Jea](audit-and-report.md) .</span><span class="sxs-lookup"><span data-stu-id="becd4-242">Additional information about identifying users' effective permissions can be found in the [auditing JEA](audit-and-report.md) article.</span></span>

## <a name="next-steps"></a><span data-ttu-id="becd4-243">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="becd4-243">Next steps</span></span>

[<span data-ttu-id="becd4-244">Skapa en konfigurations fil för sessionen</span><span class="sxs-lookup"><span data-stu-id="becd4-244">Create a session configuration file</span></span>](session-configurations.md)
